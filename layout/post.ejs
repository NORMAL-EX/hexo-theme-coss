<div class="py-8">
  <div class="mx-auto w-full max-w-6xl px-4 sm:px-6 lg:px-8">
    <div class="flex flex-col lg:flex-row gap-8">
      <%# Main Content %>
        <div class="flex-1 min-w-0">
          <article
            class="relative flex flex-col gap-6 rounded-2xl border bg-card bg-clip-padding text-card-foreground shadow-xs before:pointer-events-none before:absolute before:inset-0 before:rounded-[calc(var(--radius-2xl)-1px)] before:shadow-[0_1px_--theme(--color-black/4%)] dark:bg-clip-border dark:before:shadow-[0_-1px_--theme(--color-white/8%)] overflow-hidden">
            <%# Cover Image %>
              <% if (page.cover) { %>
                <div class="aspect-video overflow-hidden">
                  <img src="<%= page.cover %>" alt="<%= page.title %>" class="w-full h-full object-cover">
                </div>
                <% } %>

                  <div class="p-6 lg:p-8">
                    <%# Title - 靠左对齐 %>
                      <h1 class="text-3xl font-bold mb-4 text-left">
                        <%= page.title %>
                      </h1>

                      <%# Meta Info %>
                        <div class="flex flex-wrap items-center gap-4 text-sm text-muted-foreground mb-6">
                          <span class="flex items-center gap-1">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                              stroke-linejoin="round">
                              <path d="M8 2v4"></path>
                              <path d="M16 2v4"></path>
                              <rect width="18" height="18" x="3" y="4" rx="2"></rect>
                              <path d="M3 10h18"></path>
                            </svg>
                            <time datetime="<%= date_xml(page.date) %>">
                              <%= date(page.date, 'YYYY年MM月DD日' ) %>
                            </time>
                          </span>

                          <% if (page.updated && page.updated.toISOString() !==page.date.toISOString()) { %>
                            <span class="flex items-center gap-1">
                              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                              </svg>
                              <span>更新于 <%= date(page.updated, 'YYYY年MM月DD日' ) %></span>
                            </span>
                            <% } %>

                              <% if (page.categories && page.categories.length> 0) { %>
                                <span class="flex items-center gap-1">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path
                                      d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z">
                                    </path>
                                  </svg>
                                  <% page.categories.each(function(cat, idx) { %>
                                    <a href="<%= url_for(cat.path) %>" class="hover:text-foreground">
                                      <%= cat.name %>
                                    </a>
                                    <% if (idx < page.categories.length - 1) { %>, <% } %>
                                        <% }); %>
                                </span>
                                <% } %>
                        </div>

                        <%# Tags %>
                          <% if (page.tags && page.tags.length> 0) { %>
                            <div class="flex flex-wrap gap-2 mb-6">
                              <% page.tags.each(function(tag) { %>
                                <a href="<%= url_for(tag.path) %>"
                                  class="relative inline-flex shrink-0 items-center justify-center gap-1 whitespace-nowrap rounded-sm border border-transparent font-medium outline-none transition-shadow focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-1 focus-visible:ring-offset-background disabled:pointer-events-none disabled:opacity-64 [&_svg:not([class*='opacity-'])]:opacity-80 [&_svg:not([class*='size-'])]:size-3.5 sm:[&_svg:not([class*='size-'])]:size-3 [&_svg]:pointer-events-none [&_svg]:shrink-0 [button,a&]:cursor-pointer [button,a&]:pointer-coarse:after:absolute [button,a&]:pointer-coarse:after:size-full [button,a&]:pointer-coarse:after:min-h-11 [button,a&]:pointer-coarse:after:min-w-11 h-5.5 min-w-5.5 px-1 sm:h-4.5 sm:min-w-4.5 sm:text-xs bg-secondary text-secondary-foreground [button,a&]:hover:bg-secondary/90 text-xs cursor-pointer hover:bg-accent">
                                  <%= tag.name %>
                                </a>
                                <% }); %>
                            </div>
                            <% } %>

                              <%# Content %>
                                <div
                                  class="prose prose-neutral dark:prose-invert max-w-none prose-headings:scroll-mt-20 prose-headings:font-semibold prose-a:text-primary prose-a:no-underline hover:prose-a:underline prose-code:before:content-none prose-code:after:content-none prose-code:bg-muted prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-pre:bg-muted prose-pre:border prose-img:rounded-lg prose-img:shadow-md prose-blockquote:border-l-primary prose-blockquote:bg-muted/50 prose-blockquote:py-1">
                                  <%- page.content %>
                                </div>

                                <%# Copyright %>
                                  <% if (theme.copyright?.enable !==false && page.copyright !==false) { %>
                                    <% var rawPermalink=config.url.replace(/\/$/, '' ) + '/' + page.path; %>
                                      <div
                                        class="mt-8 p-4 bg-neutral-50 dark:bg-neutral-950 rounded-lg text-sm text-muted-foreground">
                                        <p class="mb-2">
                                          <strong>本文作者：</strong>
                                          <%= config.author %>
                                        </p>
                                        <p class="mb-2">
                                          <strong>本文链接：</strong>
                                          <a href="<%= rawPermalink %>" class="text-primary hover:underline break-all">
                                            <%= rawPermalink %>
                                          </a>
                                        </p>
                                        <p>
                                          <strong>版权声明：</strong>
                                          <%= theme.copyright.text || '本博客所有文章除特别声明外，均采用 CC BY-NC-SA 4.0 许可协议。转载请注明出处！'
                                            %>
                                        </p>
                                      </div>
                                      <% } %>


                                        <%# Post Navigation %>
                                          <div
                                            class="mt-8 pt-8 border-t flex flex-col sm:flex-row justify-between gap-4">
                                            <% if (page.prev) { %>
                                              <a href="<%= url_for(page.prev.path) %>"
                                                class="[&_svg]:-mx-0.5 relative inline-flex shrink-0 cursor-pointer items-center justify-center gap-2 whitespace-nowrap rounded-lg border font-medium text-base outline-none transition-shadow before:pointer-events-none before:absolute before:inset-0 before:rounded-[calc(var(--radius-lg)-1px)] pointer-coarse:after:absolute pointer-coarse:after:size-full pointer-coarse:after:min-h-11 pointer-coarse:after:min-w-11 focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-1 focus-visible:ring-offset-background disabled:pointer-events-none disabled:opacity-64 sm:text-sm [&_svg:not([class*='opacity-'])]:opacity-80 [&_svg:not([class*='size-'])]:size-4.5 sm:[&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0 border-border bg-background bg-clip-padding shadow-xs not-disabled:not-active:not-data-pressed:before:shadow-[0_1px_--theme(--color-black/4%)] dark:bg-input/32 dark:not-in-data-[slot=group]:bg-clip-border dark:not-disabled:before:shadow-[0_-1px_--theme(--color-white/4%)] dark:not-disabled:not-active:not-data-pressed:before:shadow-[0_-1px_--theme(--color-white/8%)] [:disabled,:active,[data-pressed]]:shadow-none [:hover,[data-pressed]]:bg-accent/50 dark:[:hover,[data-pressed]]:bg-input/64 h-9 px-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                  viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                  stroke-linecap="round" stroke-linejoin="round" class="shrink-0">
                                                  <path d="m15 18-6-6 6-6" />
                                                </svg>
                                                <span class="truncate">
                                                  <%= page.prev.title %>
                                                </span>
                                              </a>
                                              <% } else { %>
                                                <div></div>
                                                <% } %>

                                                  <% if (page.next) { %>
                                                    <a href="<%= url_for(page.next.path) %>"
                                                      class="relative inline-flex shrink-0 cursor-pointer items-center justify-center gap-2 whitespace-nowrap rounded-lg border bg-clip-padding font-medium text-sm outline-none transition-shadow before:pointer-events-none before:absolute before:inset-0 before:rounded-[calc(var(--radius-lg)-1px)] pointer-coarse:after:absolute pointer-coarse:after:size-full pointer-coarse:after:min-h-11 pointer-coarse:after:min-w-11 focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-1 focus-visible:ring-offset-background disabled:pointer-events-none disabled:opacity-64 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0 h-9 px-3 not-disabled:inset-shadow-[0_1px_--theme(--color-white/16%)] border-primary bg-primary text-primary-foreground shadow-primary/24 shadow-xs hover:bg-primary/90 [&:is(:active,[data-pressed])]:inset-shadow-[0_1px_--theme(--color-black/8%)] [&:is(:disabled,:active,[data-pressed])]:shadow-none
">
                                                      <span class="truncate">
                                                        <%= page.next.title %>
                                                      </span>
                                                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                        viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                                        class="shrink-0">
                                                        <path d="m9 18 6-6-6-6" />
                                                      </svg>
                                                    </a>
                                                    <% } else { %>
                                                      <div></div>
                                                      <% } %>
                                          </div>

                                          <%# Comments %>
                                            <%- partial('_partial/comment') %>
                  </div>
          </article>
        </div>

        <%# Sidebar with TOC - only show if there's content %>
          <% var showAuthor=!theme.sidebar || theme.sidebar.showAuthor !==false; var showCategories=(!theme.sidebar ||
            theme.sidebar.showCategories !==false) && site.categories.length> 0;
            var showTags = (!theme.sidebar || theme.sidebar.showTags !== false) && site.tags.length > 0;
            var showRecent = !theme.sidebar || theme.sidebar.showRecent !== false;
            var hasSidebarContent = showAuthor || showCategories || showTags || showRecent;
            var hasToc = page.toc !== false && toc(page.content).length > 0;
            %>
            <% if (hasSidebarContent || hasToc) { %>
              <div class="w-full lg:w-80 shrink-0">
                <div class="lg:sticky lg:top-20 space-y-6">
                  <%# TOC %>
                    <% if (hasToc) { %>
                      <div
                        class="relative flex flex-col rounded-2xl border bg-card bg-clip-padding text-card-foreground shadow-xs before:pointer-events-none before:absolute before:inset-0 before:rounded-[calc(var(--radius-2xl)-1px)] before:shadow-[0_1px_--theme(--color-black/4%)] dark:bg-clip-border dark:before:shadow-[0_-1px_--theme(--color-white/8%)] p-4">
                        <h4 class="font-semibold mb-4">目录</h4>
                        <nav class="text-sm">
                          <%- toc(page.content, {class: 'toc' , list_number: false}) %>
                        </nav>
                      </div>
                      <% } %>

                        <% if (hasSidebarContent) { %>
                          <%- partial('_partial/sidebar') %>
                            <% } %>
                </div>
              </div>
              <% } %>
    </div>
  </div>
</div>

<style>
  .toc-level-1 {
    margin-left: 0;
  }

  .toc-level-2 {
    margin-left: 1rem;
  }

  .toc-level-3 {
    margin-left: 2rem;
  }

  .toc-level-4 {
    margin-left: 3rem;
  }

  .toc-link {
    display: block;
    padding: 0.25rem 0;
    color: var(--muted-foreground);
    transition: color 0.2s;
  }

  .toc-link:hover {
    color: var(--foreground);
  }
</style>